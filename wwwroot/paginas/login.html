<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Iniciar Sesión</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light d-flex align-items-center justify-content-center vh-100">

    <div class="card shadow p-4" style="width: 100%; max-width: 400px;">
        <h4 class="mb-4 text-center">🔐 Iniciar Sesión</h4>
        <div class="mb-3">
            <label for="registro" class="form-label">Registro</label>
            <input type="text" class="form-control" id="registro" placeholder="Ingrese registro">
        </div>

        <div class="mb-3">
            <label for="contrasena" class="form-label">Contraseña</label>
            <input type="password" class="form-control" id="contrasena" placeholder="CI">
        </div>

        <button type="button" class="btn btn-primary w-100" onclick="iniciarSesion()">Iniciar sesión</button>



        <p class="mt-3 text-danger text-center" id="mensajeError"></p>
    </div>

    <script>
        async function iniciarSesion() {
             console.log("Botón presionado");
             const registro = document.getElementById("registro").value.trim();
             const contrasena = document.getElementById("contrasena").value.trim();
             const mensaje = document.getElementById("mensajeError");

           if (isNaN(registro) || isNaN(contrasena)) {
            mensaje.textContent = "Por favor ingresa valores válidos.";
              return;
            }


            try {
               const BASE_URL = "https://clasificador-inteligente.onrender.com";

               const response = await fetch(`${BASE_URL}/api/usuario/login`, {

                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ registro, contrasena })
                });

                if (response.ok) {
                    const data = await response.json();
                    localStorage.setItem('loginExitoso', 'true');
                    
                    //  Guarda el nombre completo si existe en la respuesta
                    if (data && data.nombreCompleto) { // Nota: Ya no es data.data.nombreCompleto, sino data.nombreCompleto
                    localStorage.setItem('nombreUsuarioCompleto', data.nombreCompleto);
                }
                    window.location.href = "faq.html";
                } else {
                    mensaje.textContent = "Credenciales inválidas.";
                }
            } catch (error) {
                mensaje.textContent = "Error al conectar con el servidor.";
            }
            
        }
    </script>

</body>
</html>
